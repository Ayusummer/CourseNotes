# é…ç½®ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤(ä¸ªäººæ­å»ºè®°å½•)

[å®˜æ–¹æ–‡æ¡£: Apache Hadoop 3.3.1 â€“ Hadoop: Setting up a Single Node Cluster.](https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html)[Apache Hadoop 3.3.1 â€“ Hadoop: Setting up a Single Node Cluster.](https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html)

---

## ç›®çš„

æ­å»ºå¹¶é…ç½®ä¸€ä¸ª `single-node(å•èŠ‚ç‚¹) Hadoop`  ä»¥ä¾¿å¿«é€Ÿä½¿ç”¨ Hadoop MapReduce åŠ HDFSæ‰§è¡Œä¸€äº›ç®€å•çš„æ“ä½œ

å‚è€ƒæ–‡æ¡£ä¸ºå®˜ç½‘ `3.3.1` ç‰ˆæœ¬çš„æ–‡æ¡£

---

## å…ˆå†³æ¡ä»¶

### æ­å»ºç¯å¢ƒ

`Win11(dev) + WSL2 + Ubuntu 20.04 LTS + VSCode + Remote-SSH(VSCodeæ‰©å±•) + Terminal(VSCodeæ‰©å±•)`

![image-20211024184047856](http://cdn.ayusummer233.top/img/202110241840353.png)

![image-20210920183032515](http://cdn.ayusummer233.top/img/202110241842705.png)

![image-20211024184349173](http://cdn.ayusummer233.top/img/202110241843423.png)

![image-20211024184748477](http://cdn.ayusummer233.top/img/202110241847999.png)

---

### éœ€è¦å®‰è£…çš„è½¯ä»¶

1. java

   > [Hadoop Java Versions - Hadoop - Apache Software Foundation](https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions)
   >
   > Hadoop 3.3 åŠæ›´æ–°çš„ç‰ˆæœ¬æ”¯æŒ Java8 å’Œ Java11(**ä»…è¿è¡Œ**)
   >
   > è¯·ä½¿ç”¨ Java 8 ç¼–è¯‘ Hadoop; ç›®å‰æš‚ä¸æ”¯æŒ Java 11 ç¼–è¯‘ Hadoop

   ç”±äº Oracle Javaæ”¶è´¹æ‰€ä»¥å®‰è£… OpenJDK

   ```shell
   sudo apt install openjdk-8-jdk
   ```

   

   > [Ubuntu 18.04 å®‰è£…java8 - èŠ±è½æœªæ®‡ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/zzy1024/p/11406269.html)
   >
   > ![image-20211024190319975](http://cdn.ayusummer233.top/img/202110241903087.png)
   >
   > `Failed to fetch æ¥ 404 é”™è¯¯`
   >
   > åˆè¯•äº†ä¸‹ java 11, ç»“æœç•…é€šæ— é˜»ğŸ˜…
   >
   > ![image-20211024192048679](http://cdn.ayusummer233.top/img/202110241920778.png)
   >
   > Java 11 æ˜¯ Java çš„ä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼ˆLTSï¼‰ã€‚å®ƒåŒæ—¶ä¹Ÿæ˜¯ Ubuntu 20.04çš„é»˜è®¤ Java å¼€å‘å’Œè¿è¡Œç¯å¢ƒã€‚
   >
   > Java 8ï¼Œå‰ä¸€ä¸ª Java LTS ç‰ˆæœ¬ï¼Œç›®å‰ä»è¢«å¹¿æ³›åº”ç”¨ã€‚
   >
   > æ›´æ–°ä¸‹æº
   >
   > ```shell
   > apt update
   > ```
   >
   > ![image-20211024192347636](http://cdn.ayusummer233.top/img/202110241923871.png)
   >
   > å†ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£… java 8 ,ç„¶åæˆåŠŸäº†ğŸ˜…
   >
   > ```shell
   > apt install openjdk-8-jdk
   > ```
   >
   > ![image-20211024192700851](http://cdn.ayusummer233.top/img/202110241927959.png)
   >
   > é‚£ä¹ˆæ­¤æ—¶æˆ‘çš„ `ubuntu 20.04` ä¸­æœ‰ä¸¤ä¸ª java, ç¼–è¯‘ Hadoop éœ€è¦ Java 8, å½“å‰é»˜è®¤çš„æ˜¯ java 11, æ‰€ä»¥éœ€è¦æ›´æ”¹é»˜è®¤ç‰ˆæœ¬
   >
   > ```shell
   > sudo update-alternatives --config java
   > ```
   >
   > ![image-20211024193029622](http://cdn.ayusummer233.top/img/202110241930723.png)
   >
   > ![image-20211024193457195](http://cdn.ayusummer233.top/img/202110241934341.png)

   åœ¨ä¸€äº› Java åº”ç”¨ä¸­, ç¯å¢ƒå˜é‡ `JAVA_HOME` è¢«ç”¨æ¥è¡¨ç¤º Java å®‰è£…ä½ç½®

   ä¸Šä¸€æ­¥ä¸­ä½¿ç”¨ `sudo update-alternatives --config java` çœ‹åˆ°äº†å„ç‰ˆæœ¬ java çš„å®‰è£…ä½ç½®

   ```shell
     Selection    Path                                            Priority   Status
   ------------------------------------------------------------
     0            /usr/lib/jvm/java-11-openjdk-amd64/bin/java      1111      auto mode
     1            /usr/lib/jvm/java-11-openjdk-amd64/bin/java      1111      manual mode
   * 2            /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java   1081      manual mode
   ```

   ç„¶åæ‰“å¼€ `/etc/environment` æ–‡ä»¶æ·»åŠ  `JAVA_HOME`

   ![image-20211024194431375](http://cdn.ayusummer233.top/img/202110241944436.png)

   é‡è½½ç¯å¢ƒå˜é‡

   ```shell
   source /etc/environment
   ```

   æŸ¥çœ‹ `JAVA_HOME` ç”Ÿæ•ˆæƒ…å†µ

   ```shell
   echo $JAVA_HOME
   ```

   ![image-20211024194542257](http://cdn.ayusummer233.top/img/202110241945329.png)

   > [å¦‚ä½•åœ¨ Ubuntu 20.04 ä¸Šå®‰è£… Java - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/137114682)
   >
   > å¯ä»¥ä½¿ç”¨ `apt remove` å‘½ä»¤å¸è½½ç›¸åº”ç‰ˆæœ¬ java

---

2. SSH å¿…é¡»å®‰è£…

![image-20211024195027098](http://cdn.ayusummer233.top/img/202110241950309.png)

---

### å®‰è£…è½¯ä»¶

å®‰è£… `ssh` å’Œ `pdsh`

```shell
sudo apt-get install ssh
sudo apt-get install pdsh
```

> ![image-20211024195241497](http://cdn.ayusummer233.top/img/202110241952019.png)
>
> ![image-20211024195311555](http://cdn.ayusummer233.top/img/202110241953340.png)

---

## ä¸‹è½½

ä»[Index of /hadoop/common/hadoop-3.3.1 (apache.org)](https://dlcdn.apache.org/hadoop/common/hadoop-3.3.1/)è·å–ç¨³å®šçš„å‘è¡Œç‰ˆ

![image-20211024200422270](http://cdn.ayusummer233.top/img/202110242004180.png)

AArch64 æ˜¯ ARMv8 çš„ä¸€ç§æ‰§è¡ŒçŠ¶æ€

æœ¬åœ°ç”µè„‘æ˜¯ amd64 æ¶æ„çš„, ä¸èƒ½ç”¨é‚£ä¸ªåŒ…

![image-20211024200916933](http://cdn.ayusummer233.top/img/202110242012238.png)

> [ã€CPUã€‘å…³äºx86ã€x86_64/x64ã€amd64å’Œarm64/aarch64 - ç®€ä¹¦ (jianshu.com)](https://www.jianshu.com/p/2753c45af9bf)

> æ‰“ç®—æ”¾åˆ° `root/Hadoop` ç›®å½•ä¸‹:
>
> ![image-20211024201716352](http://cdn.ayusummer233.top/img/202110242017511.png)
>
> IDM è¿˜æŒºå¿«çš„, ä¸è¿‡é€Ÿåº¦åŸºæœ¬ç»´æŒåœ¨ 1M å·¦å³, ç›´æ¥ä½¿ç”¨ `wget` å‘½ä»¤ä»æ–‡ä»¶åœ°å€ä¸‹è½½å€’å¿«äº†å¾ˆå¤š
>
> ![image-20211024201843596](http://cdn.ayusummer233.top/img/202110242018666.png)

---

## å‡†å¤‡å¯åŠ¨ Hadoop Cluster

è§£å‹ç¼©ä¸‹è½½çš„å‹ç¼©åŒ…

```shell
tar -xf hadoop-3.3.1.tar.gz
```

> ![image-20211024202357274](http://cdn.ayusummer233.top/img/202110242023871.png)

æ‰“å¼€è§£å‹åçš„æ–‡ä»¶å¤¹ä¸­çš„ `etc/hadoop/hadoop-env.sh` æ–‡ä»¶, å®šä¹‰å¦‚ä¸‹å‚æ•°:

```shell
 # set to the root of your Java installation
 export JAVA_HOME=/usr/java/latest
```

å…¶å®[ä¸Šä¸€æ­¥](#éœ€è¦å®‰è£…çš„è½¯ä»¶)å·²ç»è®¾ç½®äº†ç¯å¢ƒå˜é‡ JAVA_HOME, ä¸è¿‡åœ¨è¿™é‡Œè®¾å®šä¸ºé¡¹ç›®å‚æ•°çš„è¯ä¹Ÿå¯ä»¥

![image-20211024213941363](http://cdn.ayusummer233.top/img/202110242139488.png)

`cd` åˆ°è§£å‹ç¼©æ–‡ä»¶å¤¹æ ¹ç›®å½•å†æ‰§è¡Œ `bin/hadoop`

```shell
cd Hadoop/hadoop-3.3.1
bin/hadoop
```

![image-20211024214152222](http://cdn.ayusummer233.top/img/202110242141351.png)

å¯ä»¥çœ‹åˆ° Hadoop çš„ä½¿ç”¨æ–‡æ¡£

åˆ°æ­¤ä¸ºæ­¢å·²ç»å‡†å¤‡å¥½äº†åœ¨ä¸‰ç§æ”¯æŒæ¨¡å¼ä¹‹ä¸€å¯åŠ¨ Hadoop Cluster

- [æœ¬åœ°(ç‹¬ç«‹)æ¨¡å¼  Local (Standalone) Mode](#ç‹¬ç«‹æ“ä½œ)
- [ä¼ªåˆ†å¸ƒæ¨¡å¼  Pseudo-Distributed Mode](#ä¼ªåˆ†å¸ƒå¼æ“ä½œ)
- [å…¨åˆ†å¸ƒå¼æ¨¡å¼ Fully-Distributed Mode](#å…¨åˆ†å¸ƒå¼æ“ä½œ)

---

## ç‹¬ç«‹æ“ä½œ

é»˜è®¤æƒ…å†µä¸‹, Hadoop è¢«é…ç½®ä¸ºä»¥ non-distributed æ¨¡å¼è¿è¡Œ, ä½œä¸ºå•ä¸ª java è¿›ç¨‹. è¿™æ ·è°ƒè¯•æ¯”è¾ƒæ–¹ä¾¿

---

## ä¼ªåˆ†å¸ƒå¼æ“ä½œ

Hadoop å¯ä»¥åœ¨å•èŠ‚ç‚¹ä¸Šä»¥ä¸€ç§ä¼ªåˆ†å¸ƒå¼çš„æ¨¡å¼è¿è¡Œ, å…¶ä¸­æ¯ä¸ª Hadoop daemon ä»¥ä¸€ä¸ªå•ç‹¬çš„ java è¿›ç¨‹è¿è¡Œ

---

### é…ç½®

ä½¿ç”¨å¦‚ä¸‹é…ç½®æ–‡ä»¶:

`etc/Hadoop/core-site.xml`

```xml
<configuration>
    <property>
        <name>fs.defaultFS</name>
        <value>hdfs://localhost:9000</value>
    </property>
</configuration>
```

![image-20211024221117826](http://cdn.ayusummer233.top/img/202110242211948.png)

`etc/hadoop/hdfs-site.xml`

```xml
<configuration>
    <property>
        <name>dfs.replication</name>
        <value>1</value>
    </property>
</configuration>
```

![image-20211024221228547](http://cdn.ayusummer233.top/img/202110242212529.png)

---

### é…ç½®æ— å¯†ç  SSH

ç°åœ¨æ£€æŸ¥ä¸‹æ˜¯å¦å¯ä»¥ä¸ç”¨å¯†ç  ssh ä¸Š localhost

```shell
ssh localhost
```

> å¦‚æœæç¤ºéœ€è¦å¯†ç ç»§ç»­æ‰§è¡Œçš„è¯å¯ä»¥å¦‚ä¸‹é…ç½®:
>
> ```shell
> ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa
> cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
> chmod 0600 ~/.ssh/authorized_keys
> ```
>
> ---
>
> `ssh: connect to host localhost port 22: Connection refusedï¼‰`
>
> [wsl çš„ ssh server æ— æ³•å¯åŠ¨ ï¼ˆssh localhost æ—¶æŠ¥é”™ssh: connect to host localhost port 22: Connection refusedï¼‰_hxc2101çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/hxc2101/article/details/113617870)
>
> æ‰“å¼€ `/etc/ssh/sshd_config` å°†ç›‘å¬åœ°å€ localhost å–æ¶ˆæ³¨é‡Š:
>
> ![image-20211026214222894](http://cdn.ayusummer233.top/img/202110262142078.png)
>
> ç„¶å 
>
> ```shell
> service ssh restart
> ```
>
> > **mark ä¸‹è¿™å¥ ssh æœåŠ¡é‡å¯æŒ‡ä»¤**, ssh localhost èƒ½å¤Ÿæ­£å¸¸è¿è¡Œåå¦‚æœ WSL2 å…³é—­é‡å¯äº†å† `ssh localhost` å¯èƒ½è¿˜ä¼š `Connection refused`, è¿™æ—¶åªè¦å† `service ssh restart` ç„¶å `ssh localhost` å°±å¯ä»¥äº†
> >
> > ![image-20211026214857109](http://cdn.ayusummer233.top/img/202110262148965.png)
>
> ---
>
> ![image-20211025131945538](http://cdn.ayusummer233.top/img/202110251319717.png)
>
> [Error(15) è§£å†³ sshd: no hostkeys available -- exiting._éƒ‘æ¸…-CSDNåšå®¢](https://blog.csdn.net/qq_38225558/article/details/117793432)
>
> ```sh
> ssh-keygen -A
> /etc/init.d/ssh start
> ssh localhost
> ```
>
> 
>
> ![image-20211025132104948](http://cdn.ayusummer233.top/img/202110251321020.png)



![image-20211025125804673](http://cdn.ayusummer233.top/img/202110251258396.png)

---

### æ‰§è¡Œ

ä»¥ä¸‹æ˜¯æœ¬åœ°è¿è¡Œ MapReduce ä½œä¸š

#### 1.æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ

åœ¨ Hadoop è§£å‹æ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸‹è¿è¡Œ

```shell
bin/hdfs namenode -format
```

![image-20211024222114432](http://cdn.ayusummer233.top/img/202110242221127.png)

![image-20211024222152831](http://cdn.ayusummer233.top/img/202110242221957.png)

---

#### 2.å¯åŠ¨ NameNode daemon å’Œ DataNode daemon

```shell
sbin/start-dfs.sh
```

![image-20211024222740643](http://cdn.ayusummer233.top/img/202110242227516.png)

> `ERROR: Attempting to operate on hdfs namenode as root`
>
> [Hadoopå•ç‚¹å®‰è£…FAQ_WuTingçš„ä¸“æ -CSDNåšå®¢_hadoopå•ç‚¹å®‰è£…](https://blog.csdn.net/u013725455/article/details/70147331)
>
> ç¼–è¾‘ `start-dfs.sh` å’Œ `stop-dfs.sh`
>
> ```shell
> HDFS_DATANODE_USER=root
> HADOOP_SECURE_DN_USER=hdfs
> HDFS_NAMENODE_USER=root
> HDFS_SECONDARYNAMENODE_USER=root
> ```
>
> ![image-20211025120547517](http://cdn.ayusummer233.top/img/202110251205702.png)
>
> ![image-20211025120615732](http://cdn.ayusummer233.top/img/202110251206850.png)
>
> ç¼–è¾‘ `start-yarn.sh` å’Œ `stop-yarn.sh`
>
> ```shell
> YARN_RESOURCEMANAGER_USER=root
> HADOOP_SECURE_DN_USER=yarn
> YARN_NODEMANAGER_USER=root
> ```
>
> ![image-20211025120659391](http://cdn.ayusummer233.top/img/202110251206482.png)
>
> ![image-20211025120709151](http://cdn.ayusummer233.top/img/202110251207240.png)
>
> ä¿®æ”¹å®Œåå†æ¬¡å¯åŠ¨ `NameNode` å’Œ `DataNode`:
>
> ```shell
> sbin/start-dfs.sh
> ```
>
> ---
>
> `pdsh@xxxx: localhost: connect: Connection refused`
>
> [pdsh@xxxx: localhost: connect: Connection refused_PubliclyAccessibleçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/PubliclyAccessible/article/details/103910041)
>
>  ```shell
> export PDSH_RCMD_TYPE=ssh
>  ```
>  
>  ![image-20211025132339387](http://cdn.ayusummer233.top/img/202110251323690.png)
> 

å¯åŠ¨ `resourceManager` ç„¶åè®¿é—® `localhost:8088` å°±å¯ä»¥çœ‹åˆ°ç®¡ç†ç•Œé¢äº†:

```shell
sbin/yarn.sh
localhost:8088
```

> ![image-20211025132450858](http://cdn.ayusummer233.top/img/202110251324120.png)


---

### å•ä¸ªèŠ‚ç‚¹ä¸Šçš„ YARN

ç•¥

---

## å…¨åˆ†å¸ƒå¼æ“ä½œ

ç•¥

